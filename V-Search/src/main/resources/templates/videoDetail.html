<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.8.1/video.min.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.8.1/video-js.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-thumbnails/0.1.1/videojs.thumbnails.css"
		rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link rel="stylesheet" type="text/css" th:href="@{/detail.css}">
</head>

<body layout:fragment="content">
	<div class="container">
		<div class="card front-card">
			<video width="640" height="480" id="VideoPlayer" class="video-js vjs-default-skin">
				<source th:src="@{'data:video/mp4;base64,' + ${videoData}}" type="video/mp4">
			</video>
			<a href="#" class="btn front">
				요약
			</a>

		</div>
		<div class="card back-card">
			<video width="640" height="480" id="VideoPlayer2" class="video-js vjs-default-skin">
				<source th:src="@{'data:video/mp4;base64,' + ${videoData}}" type="video/mp4">
			</video>
			<a href="#" class="btn back">
				비요약
			</a>
		</div>
	</div>
	<form th:action="@{'/recommend/toggle/'+ ${videoNo}}" method="POST">
		<button type="submit">추천</button>
	</form>

	<form th:action="@{'/delvideos/' + ${videoNo}}" method="POST">
		<input type="hidden" name="_method" value="DELETE">
		<input type="submit" value="동영상 삭제">
	</form>

	<div>
		<form th:action="@{'/api/subscribe/'+${videoNo}}" method="POST">
			<button type="submit">구독</button>
		</form>
		<form th:action="@{'/api/subscribe/'+${videoNo}}" method="GET">
			<button type="submit">구독취소</button>
		</form>
	</div>
	<p>구독자 수 : <span th:text="${userDto.subscribeCount}"></span></p>
	<p>추천 수 : <span th:text="${recommendationsCount}"></span></p>

	<h2>Comments</h2>
	<div th:each="comment : ${comments}">
		<p>User: <span th:text="${comment.user.username}"></span></p>
		<p>Content: <span th:text="${comment.content}"></span></p>
		<hr>
	</div>

	<!-- 댓글 입력 폼 -->
	<h2>Add Comment</h2>
	<form th:action="@{/comments/create}" method="post">
		<input type="hidden" name="videoNo" th:value="${videoNo}">
		<textarea name="content" placeholder="Enter your comment" required></textarea><br>
		<button type="submit">Submit</button>
	</form>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		$('.front').on('click', function () {
			$('.card').addClass('active');
			$('#VideoPlayer').get(0).pause();
		});

		$('.back').on('click', function () {
			$('.card').removeClass('active');
		});
	</script>

	<script>
		var player = videojs("VideoPlayer", {
			controls: true,
			playsinline: true,
			preload: "auto",
			controlBar:
			{
				playToggle: true
				, pictureInPictureToggle: true
				, remainingTimeDisplay: true
				, progressControl: true
			}
		});
	</script>

</body>

</html>